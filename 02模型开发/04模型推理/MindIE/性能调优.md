# MindIE性能调优

> 参考 [MindIE性能调优流程](https://www.hiascend.com/document/detail/zh/mindie/100/mindieservice/servicedev/mindie_service0105.html)

## 内存估算

> 参考 [MindIE ScheduleConfig参数说明](https://www.hiascend.com/document/detail/zh/mindie/100/mindieservice/servicedev/mindie_service0285.html#ZH-CN_TOPIC_0000002186689269__section106720519231)

**单卡总内存  = 单卡权重占用内存 + 运行时相关变量占用内存 + KV Cache内存/内存分配比例 + 系统占用内存**

1. 单卡总内存：通过npu-smi info命令查看总显存。

2. 内存分配比例：默认0.8；可通过环境变量NPU_MEMORY_FRACTION控制；**当出现权重加载OOM情况时，可适当调高分配比例或使用更多显卡进行推理**。通过npuMemSize设置，KV Cache内存。

   另外一种计算方法为：npuMemSize=(单卡**总空闲**-权重/NPU卡数-后处理占用)*系数，其中系数取0.8。总而言之，想表达的意思是，**内存不要完全占满**。

3. 运行时相关变量占用内存：模型输入变量、输出变量、中间变量等内存。包含激活值内存。

4. 单卡权重占用内存：权重/NPU卡数

5. 系统占用内存：通过npu-smi info命令查看静息状态下使用显存。**一般系统需要用3.4GB**。可以参考下表信息，一般业务进程占用内存和卡上实际占用内存相差3.4GB。

## 
```
(qwq) root@192:/home/pae101# npu-smi info
+------------------------------------------------------------------------------------------------+
| npu-smi 24.1.rc2                 Version: 24.1.rc2                                             |
+---------------------------+---------------+----------------------------------------------------+
| NPU   Name                | Health        | Power(W)    Temp(C)           Hugepages-Usage(page)|
| Chip                      | Bus-Id        | AICore(%)   Memory-Usage(MB)  HBM-Usage(MB)        |
+===========================+===============+====================================================+
| 0     910B3               | OK            | 93.1        51                0    / 0             |
| 0                         | 0000:C1:00.0  | 0           0    / 0          3357 / 65536         |
+===========================+===============+====================================================+
| 1     910B3               | OK            | 91.2        50                0    / 0             |
| 0                         | 0000:C2:00.0  | 0           0    / 0          3350 / 65536         |
+===========================+===============+====================================================+
| 2     910B3               | OK            | 89.7        51                0    / 0             |
| 0                         | 0000:81:00.0  | 0           0    / 0          3347 / 65536         |
+===========================+===============+====================================================+
| 3     910B3               | OK            | 92.1        53                0    / 0             |
| 0                         | 0000:82:00.0  | 0           0    / 0          3348 / 65536         |
+===========================+===============+====================================================+
| 4     910B3               | OK            | 176.6       61                0    / 0             |
| 0                         | 0000:01:00.0  | 47          0    / 0          53492/ 65536         |
+===========================+===============+====================================================+
| 5     910B3               | OK            | 173.5       62                0    / 0             |
| 0                         | 0000:02:00.0  | 48          0    / 0          53491/ 65536         |
+===========================+===============+====================================================+
| 6     910B3               | OK            | 169.8       63                0    / 0             |
| 0                         | 0000:41:00.0  | 49          0    / 0          53491/ 65536         |
+===========================+===============+====================================================+
| 7     910B3               | OK            | 175.6       63                0    / 0             |
| 0                         | 0000:42:00.0  | 47          0    / 0          53492/ 65536         |
+===========================+===============+====================================================+
+---------------------------+---------------+----------------------------------------------------+
| NPU     Chip              | Process id    | Process name             | Process memory(MB)      |
+===========================+===============+====================================================+
| No running processes found in NPU 0                                                            |
+===========================+===============+====================================================+
| No running processes found in NPU 1                                                            |
+===========================+===============+====================================================+
| No running processes found in NPU 2                                                            |
+===========================+===============+====================================================+
| No running processes found in NPU 3                                                            |
+===========================+===============+====================================================+
| 4       0                 | 1284491       | mindie_llm_back          | 50194                   |
+===========================+===============+====================================================+
| 5       0                 | 1284493       | mindie_llm_back          | 50195                   |
+===========================+===============+====================================================+
| 6       0                 | 1284497       | mindie_llm_back          | 50195                   |
+===========================+===============+====================================================+
| 7       0                 | 1284510       | mindie_llm_back          | 50195                   |
+===========================+===============+====================================================+
```

## gsm8k benchmark

### ATB测试结果

```
[2025-03-17 17:32:16.757+08:00] [12089] [281473357974080] [benchmark] [INFO] [output.py:115]
The BenchMark test performance metric result is:
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+------+
|              Metric |         average |             max |             min |             P75 |             P90 |         SLO_P90 |             P99 |    N |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+------+
|      FirstTokenTime |      64.7768 ms |     848.3901 ms |      49.9074 ms |      69.1345 ms |       74.367 ms |       74.367 ms |      93.7642 ms | 8792 |
|          DecodeTime |      27.0037 ms |     788.9588 ms |       0.0176 ms |      27.0996 ms |      28.3229 ms |      27.6082 ms |      63.7563 ms | 8792 |
|      LastDecodeTime |      27.5678 ms |     101.4566 ms |            0 ms |      28.0333 ms |      29.2665 ms |      29.2665 ms |      63.0869 ms | 8792 |
|       MaxDecodeTime |      81.6564 ms |     788.9588 ms |      28.2619 ms |      83.5511 ms |      99.0384 ms |      99.0384 ms |     172.0248 ms | 8792 |
|        GenerateTime |   12176.1428 ms |    15100.317 ms |      53.4904 ms |   13929.2935 ms |    14138.473 ms |    14138.473 ms |   14394.8389 ms | 8792 |
|         InputTokens |         59.8964 |             212 |              12 |            71.0 |            89.0 |            89.0 |           128.0 | 8792 |
|     GeneratedTokens |        449.2916 |             512 |               1 |           512.0 |           512.0 |           512.0 |           512.0 | 8792 |
| GeneratedTokenSpeed | 36.7786 token/s | 40.9125 token/s | 11.9284 token/s | 37.3645 token/s | 37.5995 token/s | 37.5995 token/s | 38.0678 token/s | 8792 |
| GeneratedCharacters |       1492.5876 |            4086 |               0 |          1779.0 |          1930.9 |          1930.9 |         2179.09 | 8792 |
|           Tokenizer |       1.1126 ms |      14.7884 ms |       0.2434 ms |       1.3033 ms |        1.662 ms |        1.662 ms |       2.8289 ms | 8792 |
|         Detokenizer |       4.3607 ms |      13.1407 ms |       0.0107 ms |       4.9663 ms |       4.9882 ms |       4.9882 ms |       5.0328 ms | 8792 |
|  CharactersPerToken |          3.3221 |               / |               / |               / |               / |               / |               / | 8792 |
|  PostProcessingTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 8792 |
|         ForwardTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 8792 |
|    PrefillBatchsize |          1.0258 |              10 |               1 |             1.0 |             1.0 |             1.0 |             2.0 | 8792 |
|    DecoderBatchsize |          9.9792 |              20 |               1 |            10.0 |            10.0 |               / |            10.0 | 8792 |
|       QueueWaitTime |     893.4933 μs |       175689 μs |           18 μs |         92.0 μs |        114.0 μs |            / μs |      37317.0 μs | 8792 |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+------+
[2025-03-17 17:32:16.758+08:00] [12089] [281473357974080] [benchmark] [INFO] [output.py:121]
The BenchMark test common metric result is:
+------------------------+--------------------------------------+
|          Common Metric |                                Value |
+------------------------+--------------------------------------+
|            CurrentTime |                  2025-03-17 17:32:16 |
|            TimeElapsed |                         10714.4325 s |
|             DataSource | /weights/qwq32b_mindie/QwQ-32B/gsm8k |
|                 Failed |                            0( 0.0% ) |
|               Returned |                       8792( 100.0% ) |
|                  Total |                       8792[ 100.0% ] |
|            Concurrency |                                   10 |
|              ModelName |                              QwQ-32B |
|                   lpct |                            1.0815 ms |
|             Throughput |                         0.8206 req/s |
|          GenerateSpeed |                     368.6777 token/s |
| GenerateSpeedPerClient |                      36.8678 token/s |
|               accuracy |                                    / |
+------------------------+--------------------------------------+
```

为减少测试时间，使用前200条数据进行测试
```
[2025-03-18 18:25:37.112+08:00] [19845] [281472904215104] [benchmark] [INFO] [output.py:115]
The BenchMark test performance metric result is:
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
|              Metric |         average |             max |             min |             P75 |             P90 |         SLO_P90 |             P99 |   N |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
|      FirstTokenTime |      72.0491 ms |     157.0077 ms |      53.1383 ms |      73.8198 ms |      91.0187 ms |      91.0187 ms |     154.8692 ms | 200 |
|          DecodeTime |      26.5452 ms |     175.8049 ms |      16.8855 ms |      26.6399 ms |      28.0343 ms |      26.8437 ms |      63.4426 ms | 200 |
|      LastDecodeTime |      27.3349 ms |      66.9887 ms |      23.4699 ms |      28.0772 ms |      29.5626 ms |      29.5626 ms |      34.9916 ms | 200 |
|       MaxDecodeTime |      88.3943 ms |     175.8049 ms |      29.0501 ms |      93.7931 ms |     130.8392 ms |     130.8392 ms |     175.4217 ms | 200 |
|        GenerateTime |   11758.1211 ms |   15024.2586 ms |    2185.7097 ms |   13632.3061 ms |   13766.2755 ms |   13766.2755 ms |   15023.6073 ms | 200 |
|         InputTokens |           60.89 |             139 |              25 |            71.0 |            87.2 |            87.2 |          110.05 | 200 |
|     GeneratedTokens |         441.075 |             512 |              85 |           512.0 |           512.0 |           512.0 |           512.0 | 200 |
| GeneratedTokenSpeed | 37.5509 token/s | 39.9802 token/s | 33.6773 token/s | 37.9335 token/s | 38.2725 token/s | 38.2725 token/s | 39.5324 token/s | 200 |
| GeneratedCharacters |        1472.685 |            2184 |             271 |          1777.5 |          1914.8 |          1914.8 |          2161.2 | 200 |
|           Tokenizer |       0.8947 ms |      14.7295 ms |        0.267 ms |       0.9037 ms |       1.1623 ms |       1.1623 ms |       4.7797 ms | 200 |
|         Detokenizer |       4.1721 ms |       4.8983 ms |       0.8287 ms |       4.8375 ms |       4.8545 ms |       4.8545 ms |       4.8879 ms | 200 |
|  CharactersPerToken |          3.3389 |               / |               / |               / |               / |               / |               / | 200 |
|  PostProcessingTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 200 |
|         ForwardTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 200 |
|    PrefillBatchsize |          1.2195 |              10 |               1 |             1.0 |             1.0 |             1.0 |            6.74 | 200 |
|    DecoderBatchsize |         10.0086 |              20 |               1 |            10.0 |            10.0 |               / |            20.0 | 200 |
|       QueueWaitTime |     785.2857 μs |       118847 μs |           18 μs |        111.0 μs |        139.0 μs |            / μs |      36000.0 μs | 200 |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
[2025-03-18 18:25:37.113+08:00] [19845] [281472904215104] [benchmark] [INFO] [output.py:121]
The BenchMark test common metric result is:
+------------------------+------------------------------------------+
|          Common Metric |                                    Value |
+------------------------+------------------------------------------+
|            CurrentTime |                      2025-03-18 18:25:37 |
|            TimeElapsed |                                240.861 s |
|             DataSource | /weights/qwq32b_mindie/QwQ-32B/gsm8k-200 |
|                 Failed |                                0( 0.0% ) |
|               Returned |                            200( 100.0% ) |
|                  Total |                            200[ 100.0% ] |
|            Concurrency |                                       10 |
|              ModelName |                                  QwQ-32B |
|                   lpct |                                1.1833 ms |
|             Throughput |                             0.8304 req/s |
|          GenerateSpeed |                         366.2485 token/s |
| GenerateSpeedPerClient |                          36.6248 token/s |
|               accuracy |                                        / |
+------------------------+------------------------------------------+
Benchmark task completed successfully!
```

### MindSpore测试结果

#### 测试1：4卡，"npuMemSize": 8，"maxPrefillBatchSize": 1
* "maxPrefillBatchSize": 1
* "npuMemSize": 8

```
[2025-03-15 15:14:28.658+00:00] [18521] [281473289023520] [benchmark] [INFO] [output.py:114]
The BenchMark test performance metric result is:
+---------------------+----------------+-----------------+----------------+----------------+----------------+----------------+----------------+------+
|              Metric |        average |             max |            min |            P75 |            P90 |        SLO_P90 |            P99 |    N |
+---------------------+----------------+-----------------+----------------+----------------+----------------+----------------+----------------+------+
|      FirstTokenTime |     88.1944 ms |     798.5878 ms |     58.7664 ms |     94.6069 ms |    101.4279 ms |    101.4279 ms |    117.7145 ms | 8792 |
|          DecodeTime |    264.9084 ms |  221952.7402 ms |       0.011 ms |     26.7239 ms |     28.9207 ms |    473.2623 ms |     48.6279 ms | 8792 |
|      LastDecodeTime |      27.154 ms |      60.4694 ms |           0 ms |     27.6552 ms |     29.8138 ms |     29.8138 ms |      47.966 ms | 8792 |
|       MaxDecodeTime |  107179.843 ms |  221952.7402 ms |  64154.0973 ms | 114097.2967 ms | 119005.0737 ms | 119005.0737 ms | 125618.2632 ms | 8792 |
|        GenerateTime | 118536.9295 ms |  235183.5744 ms |     69.5162 ms | 126327.1709 ms | 131720.5082 ms | 131720.5082 ms | 138796.4644 ms | 8792 |
|         InputTokens |        59.8964 |             212 |             12 |           71.0 |           89.0 |           89.0 |          128.0 | 8792 |
|     GeneratedTokens |       448.1056 |             512 |              1 |          512.0 |          512.0 |          512.0 |          512.0 | 8792 |
| GeneratedTokenSpeed | 3.8218 token/s | 14.3851 token/s | 0.3871 token/s | 4.3693 token/s | 4.6785 token/s | 4.6785 token/s |  5.501 token/s | 8792 |
| GeneratedCharacters |      1510.9037 |            2545 |              0 |        1816.25 |         1967.0 |         1967.0 |         2213.0 | 8792 |
|           Tokenizer |      2.3106 ms |       11.507 ms |      0.7014 ms |      2.6737 ms |       3.729 ms |       3.729 ms |      6.4025 ms | 8792 |
|         Detokenizer |      1.0502 ms |       4.0472 ms |       0.015 ms |      1.2019 ms |      1.2228 ms |      1.2228 ms |      1.2856 ms | 8792 |
|  CharactersPerToken |         3.3718 |               / |              / |              / |              / |              / |              / | 8792 |
|  PostProcessingTime |           0 ms |            0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms | 8792 |
|         ForwardTime |           0 ms |            0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms | 8792 |
|    PrefillBatchsize |            1.0 |               1 |              1 |            1.0 |            1.0 |            1.0 |            1.0 | 8792 |
|    DecoderBatchsize |            1.0 |               1 |              1 |            1.0 |            1.0 |              / |            1.0 | 8792 |
|       QueueWaitTime | 238119.3935 μs |    221922274 μs |          10 μs |        55.0 μs |        65.0 μs |           / μs |       142.0 μs | 8792 |
+---------------------+----------------+-----------------+----------------+----------------+----------------+----------------+----------------+------+
[2025-03-15 15:14:28.660+00:00] [18521] [281473289023520] [benchmark] [INFO] [output.py:120]
The BenchMark test common metric result is:
+------------------------+--------------------------+
|          Common Metric |                    Value |
+------------------------+--------------------------+
|            CurrentTime |      2025-03-15 15:14:28 |
|            TimeElapsed |            104279.0743 s |
|             DataSource | /home/work/QwQ-32B/gsm8k |
|                 Failed |                0( 0.0% ) |
|               Returned |           8792( 100.0% ) |
|                  Total |           8792[ 100.0% ] |
|            Concurrency |                       10 |
|              ModelName |                  QwQ-32B |
|                   lpct |                1.4724 ms |
|             Throughput |             0.0843 req/s |
|          GenerateSpeed |          37.7808 token/s |
| GenerateSpeedPerClient |           3.7781 token/s |
|               accuracy |                        / |
+------------------------+--------------------------+
```

#### 测试2：4卡，"npuMemSize": 35，"maxPrefillBatchSize": 1
* "maxPrefillBatchSize": 1
* "npuMemSize": 35

为减少测试时间，使用前200条数据进行测试

```
[2025-03-18 11:42:57.065+00:00] [35602] [281473348116512] [benchmark] [INFO] [output.py:114]
The BenchMark test performance metric result is:
+---------------------+----------------+----------------+----------------+----------------+----------------+----------------+----------------+-----+
|              Metric |        average |            max |            min |            P75 |            P90 |        SLO_P90 |            P99 |   N |
+---------------------+----------------+----------------+----------------+----------------+----------------+----------------+----------------+-----+
|      FirstTokenTime |    106.8642 ms |    766.6764 ms |     61.2204 ms |     89.4486 ms |     96.8093 ms |     96.8093 ms |    678.2679 ms | 200 |
|          DecodeTime |    272.8685 ms | 240991.5447 ms |     18.9562 ms |       26.88 ms |     29.1581 ms |    507.8787 ms |     44.7554 ms | 200 |
|      LastDecodeTime |     27.3458 ms |     44.6792 ms |     23.6018 ms |     28.1029 ms |      30.421 ms |      30.421 ms |     43.4848 ms | 200 |
|       MaxDecodeTime |  110540.058 ms | 240991.5447 ms |  87634.1462 ms | 113301.1768 ms | 119612.0382 ms | 119612.0382 ms | 215188.2593 ms | 200 |
|        GenerateTime | 122445.6956 ms | 254751.9505 ms |  93431.3636 ms | 125816.2365 ms | 131786.2445 ms | 131786.2445 ms | 228628.2242 ms | 200 |
|         InputTokens |          60.89 |            139 |             25 |           71.0 |           87.2 |           87.2 |         110.05 | 200 |
|     GeneratedTokens |         449.32 |            512 |             70 |          512.0 |          512.0 |          512.0 |          512.0 | 200 |
| GeneratedTokenSpeed | 3.7201 token/s | 4.9928 token/s | 0.5706 token/s | 4.3837 token/s | 4.6082 token/s | 4.6082 token/s | 4.9746 token/s | 200 |
| GeneratedCharacters |       1523.965 |           2367 |            258 |         1832.0 |         1952.0 |         1952.0 |        2154.05 | 200 |
|           Tokenizer |      3.0427 ms |      8.4531 ms |      0.8283 ms |      3.8697 ms |       4.942 ms |       4.942 ms |       6.854 ms | 200 |
|         Detokenizer |      1.0629 ms |      1.3137 ms |      0.2007 ms |      1.2119 ms |      1.2252 ms |      1.2252 ms |      1.2969 ms | 200 |
|  CharactersPerToken |         3.3917 |              / |              / |              / |              / |              / |              / | 200 |
|  PostProcessingTime |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms | 200 |
|         ForwardTime |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms |           0 ms | 200 |
|    PrefillBatchsize |            1.0 |              1 |              1 |            1.0 |            1.0 |            1.0 |            1.0 | 200 |
|    DecoderBatchsize |            1.0 |              1 |              1 |            1.0 |            1.0 |              / |            1.0 | 200 |
|       QueueWaitTime | 246183.0655 μs |   240956110 μs |          11 μs |        46.0 μs |        57.0 μs |           / μs |       92.37 μs | 200 |
+---------------------+----------------+----------------+----------------+----------------+----------------+----------------+----------------+-----+
[2025-03-18 11:42:57.066+00:00] [35602] [281473348116512] [benchmark] [INFO] [output.py:120]
The BenchMark test common metric result is:
+------------------------+------------------------------+
|          Common Metric |                        Value |
+------------------------+------------------------------+
|            CurrentTime |          2025-03-18 11:42:57 |
|            TimeElapsed |                  2502.9557 s |
|             DataSource | /home/work/QwQ-32B/gsm8k-200 |
|                 Failed |                    0( 0.0% ) |
|               Returned |                200( 100.0% ) |
|                  Total |                200[ 100.0% ] |
|            Concurrency |                           10 |
|              ModelName |                      QwQ-32B |
|                   lpct |                     1.755 ms |
|             Throughput |                 0.0799 req/s |
|          GenerateSpeed |              35.9032 token/s |
| GenerateSpeedPerClient |               3.5903 token/s |
|               accuracy |                            / |
+------------------------+------------------------------+
Benchmark task completed successfully!
```

#### 测试2：4卡，"npuMemSize": 35，"maxPrefillBatchSize": 50
* "maxPrefillBatchSize": 50
* "npuMemSize": 35

```
[2025-03-19 08:29:17.778+00:00] [27897] [281473619693600] [benchmark] [INFO] [output.py:114]
The BenchMark test performance metric result is:
+---------------------+-----------------+-----------------+-----------------+-----------------+----------------+----------------+-----------------+-----+
|              Metric |         average |             max |             min |             P75 |            P90 |        SLO_P90 |             P99 |   N |
+---------------------+-----------------+-----------------+-----------------+-----------------+----------------+----------------+-----------------+-----+
|      FirstTokenTime |        97.07 ms |          169 ms |           62 ms |        110.0 ms |       130.1 ms |       130.1 ms |       164.02 ms | 200 |
|          DecodeTime |      29.1162 ms |          212 ms |           24 ms |         29.0 ms |        31.0 ms |     29.9204 ms |         50.0 ms | 200 |
|      LastDecodeTime |       30.005 ms |           99 ms |           26 ms |         30.0 ms |        32.0 ms |        32.0 ms |        90.07 ms | 200 |
|       MaxDecodeTime |       110.82 ms |          212 ms |           42 ms |        123.0 ms |       130.0 ms |       130.0 ms |       184.15 ms | 200 |
|        GenerateTime |    14356.007 ms |     16303.02 ms |     2164.943 ms |   15433.3689 ms |  15628.6762 ms |  15628.6762 ms |   16297.7436 ms | 200 |
|         InputTokens |           60.89 |             139 |              25 |            71.0 |           87.2 |           87.2 |          110.05 | 200 |
|     GeneratedTokens |          482.07 |             512 |              70 |           512.0 |          512.0 |          512.0 |           512.0 | 200 |
| GeneratedTokenSpeed | 33.5801 token/s | 34.9831 token/s | 31.4052 token/s | 34.3461 token/s | 34.453 token/s | 34.453 token/s | 34.7207 token/s | 200 |
| GeneratedCharacters |         1649.17 |            2309 |             258 |         1853.25 |         1979.5 |         1979.5 |         2284.18 | 200 |
|           Tokenizer |       2.4258 ms |       7.7391 ms |       0.7679 ms |       2.7465 ms |       3.667 ms |       3.667 ms |       7.4379 ms | 200 |
|         Detokenizer |       1.1688 ms |       2.1422 ms |       0.2027 ms |       1.2372 ms |      1.2781 ms |      1.2781 ms |       1.4362 ms | 200 |
|  CharactersPerToken |           3.421 |               / |               / |               / |              / |              / |               / | 200 |
|  PostProcessingTime |            0 ms |            0 ms |            0 ms |            0 ms |           0 ms |           0 ms |            0 ms | 200 |
|         ForwardTime |            0 ms |            0 ms |            0 ms |            0 ms |           0 ms |           0 ms |            0 ms | 200 |
|    PrefillBatchsize |          1.8519 |               9 |               1 |            1.25 |            5.0 |            5.0 |            7.93 | 200 |
|    DecoderBatchsize |          9.7255 |              10 |               1 |            10.0 |           10.0 |              / |            10.0 | 200 |
|       QueueWaitTime |     601.6063 μs |       170470 μs |           15 μs |         88.0 μs |       109.0 μs |           / μs |     24682.83 μs | 200 |
+---------------------+-----------------+-----------------+-----------------+-----------------+----------------+----------------+-----------------+-----+
[2025-03-19 08:29:17.779+00:00] [27897] [281473619693600] [benchmark] [INFO] [output.py:120]
The BenchMark test common metric result is:
+------------------------+------------------------------+
|          Common Metric |                        Value |
+------------------------+------------------------------+
|            CurrentTime |          2025-03-19 08:29:17 |
|            TimeElapsed |                   294.5528 s |
|             DataSource | /home/work/QwQ-32B/gsm8k-200 |
|                 Failed |                    0( 0.0% ) |
|               Returned |                200( 100.0% ) |
|                  Total |                200[ 100.0% ] |
|            Concurrency |                           10 |
|              ModelName |                      QwQ-32B |
|                   lpct |                    1.5942 ms |
|             Throughput |                  0.679 req/s |
|          GenerateSpeed |             327.3233 token/s |
| GenerateSpeedPerClient |              32.7323 token/s |
|               accuracy |                            / |
+------------------------+------------------------------+
```

```
[2025-03-19 08:56:48.023+00:00] [33672] [281473449717792] [benchmark] [INFO] [output.py:114]
The BenchMark test performance metric result is:
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
|              Metric |         average |             max |             min |             P75 |             P90 |         SLO_P90 |             P99 |   N |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
|      FirstTokenTime |       106.62 ms |          205 ms |           67 ms |       114.25 ms |        169.0 ms |        169.0 ms |       203.01 ms | 200 |
|          DecodeTime |      29.5713 ms |          158 ms |           24 ms |         30.0 ms |         31.0 ms |      30.5894 ms |         51.0 ms | 200 |
|      LastDecodeTime |       28.975 ms |           36 ms |           26 ms |         30.0 ms |         31.0 ms |         31.0 ms |        34.01 ms | 200 |
|       MaxDecodeTime |      105.755 ms |          158 ms |           44 ms |        118.0 ms |        132.0 ms |        132.0 ms |       153.05 ms | 200 |
|        GenerateTime |   14595.3279 ms |   16101.3367 ms |    2214.8981 ms |   15682.5159 ms |   15924.6978 ms |   15924.6978 ms |   16094.8832 ms | 200 |
|         InputTokens |           60.89 |             139 |              25 |            71.0 |            87.2 |            87.2 |          110.05 | 200 |
|     GeneratedTokens |         482.335 |             512 |              70 |           512.0 |           512.0 |           512.0 |           512.0 | 200 |
| GeneratedTokenSpeed | 33.0495 token/s | 34.5704 token/s | 31.4363 token/s | 33.6409 token/s | 33.9999 token/s | 33.9999 token/s | 34.5443 token/s | 200 |
| GeneratedCharacters |        1662.805 |            2402 |             258 |         1851.25 |          2007.6 |          2007.6 |         2229.11 | 200 |
|           Tokenizer |       2.0112 ms |       7.4151 ms |       0.7846 ms |       2.3573 ms |       2.9944 ms |       2.9944 ms |       4.7152 ms | 200 |
|         Detokenizer |       1.1845 ms |       2.4219 ms |       0.2034 ms |       1.2589 ms |       1.2816 ms |       1.2816 ms |       1.3882 ms | 200 |
|  CharactersPerToken |          3.4474 |               / |               / |               / |               / |               / |               / | 200 |
|  PostProcessingTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 200 |
|         ForwardTime |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms |            0 ms | 200 |
|    PrefillBatchsize |          1.9802 |               9 |               1 |             1.0 |             6.0 |             6.0 |             9.0 | 200 |
|    DecoderBatchsize |          9.7073 |              10 |               1 |            10.0 |            10.0 |               / |            10.0 | 200 |
|       QueueWaitTime |     624.7285 μs |       113082 μs |           22 μs |        128.0 μs |        144.0 μs |            / μs |     10451.42 μs | 200 |
+---------------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----------------+-----+
[2025-03-19 08:56:48.024+00:00] [33672] [281473449717792] [benchmark] [INFO] [output.py:120]
The BenchMark test common metric result is:
+------------------------+------------------------------+
|          Common Metric |                        Value |
+------------------------+------------------------------+
|            CurrentTime |          2025-03-19 08:56:48 |
|            TimeElapsed |                   299.7831 s |
|             DataSource | /home/work/QwQ-32B/gsm8k-200 |
|                 Failed |                    0( 0.0% ) |
|               Returned |                200( 100.0% ) |
|                  Total |                200[ 100.0% ] |
|            Concurrency |                           10 |
|              ModelName |                      QwQ-32B |
|                   lpct |                     1.751 ms |
|             Throughput |                 0.6671 req/s |
|          GenerateSpeed |             321.7893 token/s |
| GenerateSpeedPerClient |              32.1789 token/s |
|               accuracy |                            / |
+------------------------+------------------------------+
```

